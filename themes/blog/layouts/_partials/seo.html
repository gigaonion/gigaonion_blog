{{- $description := "" -}}
{{- if .IsHome -}}
    {{- $description = site.Params.description -}}
{{- else if .Params.description -}}
    {{- $description = .Params.description -}}
{{- else -}}
    {{- $description = .Summary | plainify | truncate 200 -}}
{{- end -}}

<meta name="description" content="{{ $description }}">
{{- with .Params.tags }}
<meta name="keywords" content="{{ delimit . ", " }}">
{{- end }}

{{/* Open Graph / Facebook */}}
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:title" content="{{ .Title }}">
<meta property="og:description" content="{{ $description }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:site_name" content="{{ site.Title }}">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title }}">
<meta name="twitter:description" content="{{ $description }}">

{{/* Canonical URL */}}
<link rel="canonical" href="{{ .Permalink }}">

{{- /* --- OGP Image Generation Logic --- */ -}}
{{- $ogImage := "" -}}

{{- if .Params.image -}}
  {{- $ogImage = .Params.image | absURL -}}

{{- else -}}
  {{- $font := resources.Get "fonts/NotoSansJP-Bold.ttf" -}}
  {{- $bg := resources.Get "images/ogp-background.png" -}}

  {{- if and $font $bg -}}
    {{- $title := .Title -}}
    {{- $options := dict
        "color" "#000"
        "size" 40
        "x" 50
        "y" 150
        "linespacing" 10
        "font" $font
    -}}
    {{- $generated := $bg.Filter (images.Text $title $options) -}}
    {{- $ogImage = $generated.Permalink -}}

  {{- else -}}
    {{- $ogImage = "logo.png" | absURL -}}
  {{- end -}}
{{- end -}}

<meta property="og:image" content="{{ $ogImage }}">
<meta name="twitter:image" content="{{ $ogImage }}">
